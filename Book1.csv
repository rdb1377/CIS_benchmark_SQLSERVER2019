index,Dsc,query,recom,RetNumbers,val1,val2,type
1.1,Ensure Latest SQL Server Cumulative and Security Updates are installed,0,0,0,0,0,0
1.2,Ensure Single-Function Member Servers are Used,0,0,0,0,0,0
2.1,"<p style =""font-family : Times New Roman ,font-size: 8px"" ><h3>2.1 Ensure 'Ad Hoc Distributed Queries' Server Configuration Option is set to '0' (Automated) </h3> <br> <b>Profile Applicability:</b> <br> &bull; Level 1 - Database Engine <br>&bull; Level 1 - AWS RDS <br><br> <b>Description:</b> <br>Enabling Ad Hoc Distributed Queries allows users to query data and execute statements on external data sources. This functionality should be disabled. <br><br> <b>Rationale:</b> <br>This feature can be used to remotely access and exploit vulnerabilities on remote SQL Server instances and to run unsafe Visual Basic for Application functions. <br><br> <b>Audit:</b> <br> Run the following T-SQL command: <br> <p style =""font-family : Courier New""> SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use <br>FROM sys.configurations <br>WHERE name = 'Ad Hoc Distributed Queries';</p> Both value columns must show 0. <br><br> <b>Remediation: </b> <br>For AWS RDS Instances, please refer to the documentation for using Parameter Groups here: <br> Working with parameter groups Run the following T-SQL command: <p style =""font-family : Courier New""> EXECUTE sp_configure 'show advnced options', 1; <br>RECONFIGURE; <br>EXECUTE sp_configure 'Ad Hoc Distributed Queries', 0; <br>RECONFIGURE; <br>GO <br> EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; </p> <b>Default Value:</b> <br>0 (disabled) <br><br> <b>References: </b> <br><a href=""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWit hParamGroups.html"">1. https://learn.microsoft.com/en-us/sql/t-sql/statements/create-assembly-transactsql</a> <br> <a href=""https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/adhoc-distributed-queries-server-configuration-option"">2.https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html</a> <br></p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Ad Hoc Distributed Queries';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ad Hoc Distributed Queries', 0; RECONFIGURE;  EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.2,"<p>2.2 Ensure 'CLR Enabled' Server Configuration Option is set to '0' (Automated)<br> <br> Profile Applicability:<br> &bull;  Level 1 - Database Engine<br> &bull;  Level 1 - AWS RDS<br> <br> Description:<br> The clr enabled option specifies whether user assemblies can be run by SQL Server.<br> Rationale:<br> Enabling use of CLR assemblies widens the attack surface of SQL Server and puts it at<br> risk from both inadvertent and malicious assemblies.<br> <br> Impact:<br> If CLR assemblies are in use, applications may need to be rearchitected to eliminate<br> their usage before disabling this setting. Alternatively, some organizations may allow<br> this setting to be enabled 1 for assemblies created with the SAFE permission set, but<br> disallow assemblies created with the riskier UNSAFE and EXTERNAL_ACCESS permission<br> sets. To find user-created assemblies, run the following query in all databases,<br> replacing <database_name> with each database name:<br> <br> USE [<database_name>]<br> GO<br> SELECT name AS Assembly_Name, permission_set_desc<br> FROM sys.assemblies<br> WHERE is_user_defined = 1;<br> GO<br> Audit:<br> Run the following T-SQL command:<br> SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations<br> WHERE name = 'clr strict security';<br> If both values are 1, this recommendation is Not Applicable. Otherwise, run the following<br> <br> T-SQL command:<br> SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations<br> WHERE name = 'clr enabled';<br> Both value columns must show 0 to be compliant.<br> <br> Remediation:<br> For AWS RDS Instances, please refer to the documentation for using Parameter<br> Groups here:<br> Working with parameter groups<br> Run the following T-SQL command:<br> EXECUTE sp_configure 'clr enabled', 0;<br> RECONFIGURE;<br> <br> Default Value:<br> By default, this option is disabled (0).<br> <br> References:<br> 1. https://learn.microsoft.com/en-us/sql/t-sql/statements/create-assembly-transact-<br> sql<br> 2. https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWit<br> hParamGroups.htm<br></p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'clr strict security';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ad Hoc Distributed Queries', 0; RECONFIGURE;  EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.3,"<p style =""font-family : Times New Roman""><h3>2.3 Ensure 'Cross DB Ownership Chaining' Server Configuration Option is set to '0' (Automated) </h3> <br> <b>Profile Applicability:</b> <br> &bull; Level 1 - Database Engine <br>&bull; Level 1 - AWS RDS <br><br> <b>Description:</b> <br>The cross db ownership chaining option controls cross-database ownership chaining across all databases at the instance (or server) level. <br><br> <b>Rationale:</b> <br>When enabled, this option allows a member of the db_owner role in a database to gain access to objects owned by a login in any other database, causing an unnecessary information disclosure. When required, cross-database ownership chaining should only be enabled for the specific databases requiring it instead of at the instance level for all databases by using the ALTER DATABASE<database_name>SET DB_CHAINING ON command. This database option may not be changed on the master, model, or tempdb system databases. <br><br> <b>Audit:</b> <br> Run the following T-SQL command: <br> <p style =""font-family : Courier New"">SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations <br> WHERE name = 'cross db ownership chaining';</p> Both value columns must show 0 to be compliant. <br><br> <b>Remediation: </b> <br>For AWS RDS Instances, please refer to the documentation for using Parameter Groups here: <a href=""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html"" >Working with parameter groups</a> Run the following T-SQL command: <p style =""font-family : Courier New""> EXECUTE sp_configure 'cross db ownership chaining', 0;<br> RECONFIGURE;<br> GO </p> <b>Default Value:</b> <br>By default, this option is disabled (0). <br><br> <b>References: </b> <br><a href=""https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/crossdb-ownership-chaining-server-configurationoption"">1.https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/crossdb-ownership-chaining-server-configuration-option</a> <br> <a href=""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html"">2.https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html</a> <br></p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'cross db ownership chaining';","EXECUTE sp_configure 'cross db ownership chaining', 0; RECONFIGURE; GO",2,0,0,1
2.4,"<p style =""font-family : Times New Roman""><h3>2.4 Ensure 'Database Mail XPs' Server Configuration Option is set to '0' (Automated)</h3> <p><br /><strong>Profile Applicability:</strong> <br />&bull; Level 1 - Database Engine <br />&bull; Level 1 - AWS RDS <br /><br /><strong>Description:</strong> <br />The Database Mail XPs option controls the ability to generate and transmit email messages from SQL Server. <br /><br /><strong>Rationale:</strong> <br />Disabling the Database Mail XPs option reduces the SQL Server surface, eliminates a DOS attack vector and channel to exfiltrate data from the database server to a remote host. <br /><br /><strong>Audit:</strong> <br />Run the following T-SQL command:</p> <p style=""font-family: Courier New;"">SELECT name,<br />CAST(value as int) as value_configured,<br />CAST(value_in_use as int) as value_in_use<br />FROM sys.configurations<br />WHERE name = 'Database Mail XPs';</p> <p>Both value columns must show 0 to be compliant. <br /><br /><strong>Remediation: </strong> <br />For AWS RDS Instances, please refer to the documentation for using Parameter Groups here: <a href=""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html"">Working with parameter groups</a> Run the following T-SQL command:</p> <p style=""font-family: Courier New;"">EXECUTE sp_configure 'show advanced options', 1;<br />RECONFIGURE;<br />EXECUTE sp_configure 'Database Mail XPs', 0;<br />RECONFIGURE;<br />GO<br />EXECUTE sp_configure 'show advanced options', 0; <br />RECONFIGURE;</p> <p><strong>Default Value:</strong> <br />By default, this option is disabled (0). <br /><br /><strong>References: </strong> <br /><a href=""https://learn.microsoft.com/en-us/sql/relational-databases/database-mail/database-mail?view=sql-server-ver16"">. https://learn.microsoft.com/en-us/sql/relational-databases/databasemail/database-mail</a> </p></P>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Database Mail XPs';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Database Mail XPs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.5,"<p style ="" font-size: 80%""><h4>2.5 Ensure 'Ole Automation Procedures' Server Configuration Option is set to '0' (Automated)</h4> <div style=""margin-top: 0px;""></div> <b>Profile Applicability:</b> <br> &bull; Level 1 - Database Engine <b>Description:</b> <br>The Ole Automation Procedures option controls whether OLE Automation objects can be instantiated within Transact-SQL batches. These are extended stored procedures that allow SQL Server users to execute functions external to SQL Server. <div style=""margin-top: 0px;""></div> <b>Rationale:</b> <br>Enabling this option will increase the attack surface of SQL Server and allow users to execute functions in the security context of SQL Server. <div style=""margin-top: 0px;""></div> <b>Audit:</b> Run the following T-SQL command: <p style =""font-family : Courier New""> SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations<br> WHERE name = 'Ole Automation Procedures'; </p> Both value columns must show 0 to be compliant. <div style=""margin-top: 0px;""></div> <b>Remediation: </b> <br>Run the following T-SQL command: <p style =""font-family : Courier New ; ""> EXECUTE sp_configure 'show advanced options', 1;<br> RECONFIGURE;<br> EXECUTE sp_configure 'Ole Automation Procedures', 0;<br> RECONFIGURE;<br> GO<br> EXECUTE sp_configure 'show advanced options', 0;<br> RECONFIGURE; </p> <div style=""margin-top: 0px;""></div> <b>Default Value:</b> <br>By default, this option is disabled (0). <br><br> <b>References: </b> <br><a href=""https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/ole-automation-procedures-server-configuration-option?view=sql-server-ver16"">1.https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/oleautomation-procedures-server-configuration-option</a> <br> </p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Ole Automation Procedures';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ole Automation Procedures', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.6,"<p style =""font-family : Times New Roman""><h3>2.6 Ensure 'Remote Access' Server Configuration Option is set to '0' (Automated)</h3> <br> <b>Profile Applicability:</b> <br> &bull; Level 1 - Database Engine <br> &bull; Level 1 - AWS RDS <br><br> <b>Description:</b> <br>The remote access option controls the execution of local stored procedures on remoteservers or remote stored procedures on local server<br><br> <b>Rationale:</b> <br>Functionality can be abused to launch a Denial-of-Service (DoS) attack on remoteservers by off-loading query processing to a target.<br><br> <br> <b>Impact</b> <br>Per Microsoft: This feature will be removed in the next version of Microsoft SQL Server. Do not use this feature in new development work, and modify applications that currently use this feature as soon as possible. Use sp_addlinkedserver instead.<br> <b>Audit:</b> <br> Run the following T-SQL command: <br> <p style =""font-family : Courier New""> SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations<br> WHERE name = 'remote access'; </p> Both value columns must show 0. <br><br> <b>Remediation: </b> For AWS RDS Instances, please refer to the documentation for using Parameter Groups here: <a href= ""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html"">Working with parameter groups</a> Otherwise, run the following T-SQL command: <p style =""font-family : Courier New""> EXECUTE sp_configure 'show advanced options', 1;<br> RECONFIGURE;<br> EXECUTE sp_configure 'remote access', 0;<br> RECONFIGURE;<br> GO<br> EXECUTE sp_configure 'show advanced options', 0;<br> RECONFIGURE; </p> Restart the Database Engine <b>Default Value:</b> <br>By default, this option is enabled (1). <br><br> <b>References: </b> <br><a href=""https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-remote-access-server-configuration-option"">1.https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/configure-the-remote-access-server-configuration-option</a> <br><a href=""https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html"">2.https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html</a> <br> </p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'remote access';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'remote access', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.7,"<p>2.7 Ensure 'Remote Admin Connections' Server Configuration Option is set to '0' (Automated)<br> <br> Profile Applicability:<br> &bull;  Level 1 - Database Engine<br> <br> Description:<br> The remote admin connections option controls whether a client application on a remote<br> computer can use the Dedicated Administrator Connection (DAC).<br> <br> Rationale:<br> The Dedicated Administrator Connection (DAC) lets an administrator access a running<br> server to execute diagnostic functions or Transact-SQL statements, or to troubleshoot<br> problems on the server, even when the server is locked or running in an abnormal state<br> and not responding to a SQL Server Database Engine connection. In a cluster scenario,<br> the administrator may not actually be logged on to the same node that is currently<br> hosting the SQL Server instance and thus is considered ""remote"". Therefore, this<br> setting should usually be enabled (1) for SQL Server failover clusters; otherwise, it<br> should be disabled (0) which is the default.<br> <br> Audit:<br> Run the following T-SQL command:<br> SELECT name,<br> CAST(value as int) as value_configured,<br> CAST(value_in_use as int) as value_in_use<br> FROM sys.configurations<br> WHERE name = 'remote admin connections'<br> AND SERVERPROPERTY('IsClustered') = 0;<br> If no data is returned, the instance is a cluster and this recommendation is not<br> applicable. If data is returned, then both the value columns must show 0 to be<br> compliant.<br> <br> Remediation:<br> Run the following T-SQL command on non-clustered installations:<br> EXECUTE sp_configure 'remote admin connections', 0;<br> RECONFIGURE;<br> GO<br> <br> Default Value:<br> By default, this option is disabled (0), only local connections may use the DAC.<br> <br> References:<br> 1. https://learn.microsoft.com/en-us/sql/database-engine/configure-<br> windows/remote-admin-connections-server-configuration-option<br> By default, this option is enabled (1).<br> <br> References:<br> 1. https://learn.microsoft.com/en-us/sql/database-engine/configure-<br> windows/configure-the-remote-access-server-configuration-option<br> 2. https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWit<br> hParamGroups.html<br> <br> <br> <br> <br> <br> <br> <br> <br> <br></p>","SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'remote admin connections' AND SERVERPROPERTY('IsClustered') = 0;","EXECUTE sp_configure 'remote admin connections', 0; RECONFIGURE; GO",2,0,0,1
2.8,2.8 Ensure 'Scan For Startup Procs' Server Configuration Option is set to '0' (Automated),"SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'scan for startup procs';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
2.9,2.9 Ensure 'Trustworthy' Database Property is set to 'Off' (Automated),SELECT name FROM sys.databases WHERE is_trustworthy_on = 1 AND name != 'msdb';,ALTER DATABASE [] SET TRUSTWORTHY OFF;,0,,,2
2.10.,2.10 Ensure Unnecessary SQL Server Protocols are set to 'Disabled' (Manual),0,0,,0,0,0
2.11,2.11 Ensure SQL Server is configured to use non-standard ports (Automated),"SELECT 'use non-standard ports', count(*) as no  FROM sys.dm_server_registry WHERE value_name like '%Tcp%' and value_data='1433';",0,1,0,,1
2.12,2.12 kooft,"DECLARE @getValue INT; EXEC master.sys.xp_instance_regread @rootkey = N'HKEY_LOCAL_MACHINE', @key = N'SOFTWARE\Microsoft\Microsoft SQL Server\MSSQLServer\SuperSocketNetLib', @value_name = N'HideInstance', @value = @getValue OUTPUT; SELECT 'Hide Instance', @getValue;","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",1,1,,1
2.14,2.14,SELECT name FROM sys.server_principals WHERE sid = 0x01;,,1,sa,,5
2.15,2.15 lolo,"SELECT name, containment, containment_desc, is_auto_close_on FROM sys.databases WHERE containment <> 0 and is_auto_close_on = 1;",0,1,,,2
2.16,2.16 askol,"SELECT principal_id, name FROM sys.server_principals WHERE name = 'sa';",0,,,,2
2.17,2.17 dard,"SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'clr strict security';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,0,0,1
3.1,3.1 zahr,"SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'clr strict security';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",1,1,,1
3.2,3.2 foo,"SELECT DB_NAME() AS DatabaseName, 'guest' AS Database_User,[permission_name], [state_desc] FROM sys.database_permissions WHERE [grantee_principal_id] = DATABASE_PRINCIPAL_ID('guest') AND [state_desc] LIKE 'GRANT%' AND [permission_name] = 'CONNECT' AND DB_NAME() NOT IN ('master','tempdb','msdb');",0,,,,2
3.3,3.3,EXEC sp_change_users_login @Action='Report';,,,,,2
3.4,3.4,"SELECT name AS DBUser FROM sys.database_principals WHERE name NOT IN ('dbo','Information_Schema','sys','guest') AND type IN ('U','S','G') AND authentication_type = 2;",,,,,2
3.5,Ensure the SQL Server's MSSQL Service Account is Not an Administrator (Manual),0,,,,,0
3.6, Ensure the SQL Server's SQLAgent Service Account is Not an Administrator (Manual),0,,,,,0
3.7,Ensure the SQL Server’s Full-Text Service Account is Not an Administrator (Manual),0,,,,,0
3.8,3.8,SELECT * FROM master.sys.server_permissions WHERE (grantee_principal_id = SUSER_SID(N'public') and state_desc LIKE 'GRANT%') AND NOT (state_desc = 'GRANT' and [permission_name] = 'VIEW ANY DATABASE' and class_desc = 'SERVER') AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 2) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 3) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 4) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 5);,,,,,2
3.9,3.9,"SELECT pr.[name], pe.[permission_name], pe.[state_desc] FROM sys.server_principals pr JOIN sys.server_permissions pe ON pr.principal_id = pe.grantee_principal_id WHERE pr.name like 'BUILTIN%';",,,,,2
3.10.,3.10.,"SELECT pr.[name] AS LocalGroupName, pe.[permission_name], pe.[state_desc] FROM sys.server_principals pr JOIN sys.server_permissions pe ON pr.[principal_id] = pe.[grantee_principal_id] WHERE pr.[type_desc] = 'WINDOWS_GROUP' AND pr.[name] like CAST(SERVERPROPERTY('MachineName') AS nvarchar) + '%';",,,,,2
3.11,3.11,SELECT sp.name AS proxyname FROM [msdb].dbo.sysproxylogin spl JOIN sys.database_principals dp ON dp.sid = spl.sid JOIN [msdb].dbo.sysproxies sp ON sp.proxy_id = spl.proxy_id WHERE principal_id = USER_ID('public');,,,,,2
4.1,Ensure 'MUST_CHANGE' Option is set to 'ON' for All SQL Authenticated Logins (Manual),0,,,,,0
4.2,4.2,"SELECT l.[name], 'sysadmin membership' AS 'Access_Method' FROM sys.sql_logins AS l WHERE IS_SRVROLEMEMBER('sysadmin',name) = 1 AND l.is_expiration_checked <> 1 UNION ALL SELECT l.[name], 'CONTROL SERVER' AS 'Access_Method' FROM sys.sql_logins AS l JOIN sys.server_permissions AS p ON l.principal_id = p.grantee_principal_id WHERE p.type = 'CL' AND p.state IN ('G', 'W') AND l.is_expiration_checked <> 1;",,,,,2
5.1,5.1,"DECLARE @NumErrorLogs int EXEC master.sys.xp_instance_regread N'HKEY_LOCAL_MACHINE', N'Software\Microsoft\MSSQLServer\MSSQLServer', N'NumErrorLogs',@NumErrorLogs OUTPUT; SELECT ISNULL(@NumErrorLogs, -1) AS [NumberOfLogFiles];",,,12,,3
5.2,5.2 sag,"SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'default trace enabled';","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",2,1,1,1
5.3,5.3 khar,EXEC xp_loginconfig 'audit level';,"EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",1,failure,,1
5.4,5.4,"SELECT S.name AS 'Audit Name' , CASE S.is_state_enabled WHEN 1 THEN 'Y' WHEN 0 THEN 'N' END AS 'Audit Enabled' , S.type_desc AS 'Write Location' , SA.name AS 'Audit Specification Name' , CASE SA.is_state_enabled WHEN 1 THEN 'Y' WHEN 0 THEN 'N' END AS 'Audit Specification Enabled' , SAD.audit_action_name , SAD.audited_result FROM sys.server_audit_specification_details AS SAD JOIN sys.server_audit_specifications AS SA ON SAD.server_specification_id = SA.server_specification_id JOIN sys.server_audits AS S ON SA.audit_guid = S.audit_guid WHERE SAD.audit_action_id IN ('CNAU', 'LGFL', 'LGSD') or (SAD.audit_action_id IN ('DAGS', 'DAGF') and (select count(*) from sys.databases where containment=1) > 0);",,,,,4
6.1,Ensure Database and Application User Input is Sanitized,0,,,,,0
6.2,6.2,"SELECT name, permission_set_desc FROM sys.assemblies WHERE is_user_defined = 1 AND name <> 'Microsoft.SqlServer.Types';",,1,SAFE_ACCESS,,6
7.1,7.1,"SELECT db_name() AS Database_Name, name AS Key_Name FROM sys.symmetric_keys WHERE algorithm_desc NOT IN ('AES_128','AES_192','AES_256') AND db_id() > 4;",,,,,2
7.2,7.2,"SELECT db_name() AS Database_Name, name AS Key_Name FROM sys.asymmetric_keys WHERE key_length < 2048 AND db_id() > 4",,,,,2
7.3,7.3,"SELECT b.key_algorithm, b.encryptor_type, d.is_encrypted, b.database_name, b.server_name FROM msdb.dbo.backupset b inner join sys.databases d on b.database_name = d.name where b.key_algorithm IS NULL AND b.encryptor_type IS NULL AND d.is_encrypted = 0;",,,,,2
7.4,7.4 WTF,"select ' Network Encryption '  , count (case when (encrypt_option= 'False') then 1 else 0 end ) from sys.dm_exec_connections;","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;",1,0,,1
7.5,7.5,"select database_id, name, is_encrypted from sys.databases where database_id > 4 and is_encrypted != 1",,,,,2
8.1,Ensure 'SQL Server Browser Service' is configured correctly (Manual),0,,,,,0
